function t(t,n){const{shiftfactor:e=.1,scalefactor:r=1.1,initialsize:o=.1,threshold:a=.2,rotation:s=[0],memory:c=1}=n,f=function(t){const n=new DataView(t.buffer,t.byteOffset,t.byteLength);let e=8;const r=n.getInt32(e,!0);e+=4;const o=1<<r,a=n.getInt32(e,!0);e+=4;const s=new Int8Array(4*a*o),c=new Float32Array(a*o),f=new Float32Array(a);for(let r=0;r<a;++r){const a=4*r*o;s[a+0]=0,s[a+1]=0,s[a+2]=0,s[a+3]=0;const i=4*o-4;s.set(t.subarray(e,e+i),a+4),e+=i;for(let t=0;t<o;++t)c[r*o+t]=n.getFloat32(e,!0),e+=4;f[r]=n.getFloat32(e,!0),e+=4}const i=new Int32Array(360),l=new Int32Array(360);for(let t=0;t<360;++t){const n=t*Math.PI/180;i[t]=256*Math.cos(n)|0,l[t]=256*Math.sin(n)|0}return function(t,n,e,u,h,g){t<<=16,n<<=16;const w=u*l[e|=0],y=u*i[e];let m=0;for(let e=0;e<a;++e){let a=1;for(let c=0;c<r;++c){const r=4*(o*e+a),c=s[r+0],f=s[r+1],i=s[r+2],l=s[r+3],u=t+y*i-w*l>>16,m=n+w*i+y*l>>16;a=2*a+((0|h[(t+y*c-w*f>>16)*g+(n+w*c+y*f>>16)])<=(0|h[u*g+m])?1:0)}if(m+=c[o*(e-1)+a],m<=f[e])return-1}return m-f[a-1]}}(new Int8Array(t)),i=function(t){let n=0;const e=[];for(let n=0;n<t;++n)e.push([]);return function(t){e[n]=t,n=(n+1)%e.length,t=[];for(let n=0;n<e.length;++n)t=t.concat(e[n]);return t}}(c);function l(t,n){const[e,r,o]=t,[a,s,c]=n,f=Math.max(0,Math.min(e+o/2,a+c/2)-Math.max(e-o/2,a-c/2)),i=Math.max(0,Math.min(r+o/2,s+c/2)-Math.max(r-o/2,s-c/2)),l=Math.min(o,c);return f*i/(l*l)}return function(t){const{data:n,width:c,height:u}=t,h=function(t,n,e,r,o,a,s,c){const f=[],i=c.length,l=s*Math.sqrt(n*e)|0;let u=0|Math.min(n,e);for(;u>=l;){const s=o*u+1|0,l=u/2+1|0;for(let o=l;o<e-l;o+=s)for(let e=l;e<n-l;e+=s)for(let a=0;a<i;a++){const s=c[a],i=r(o,e,s,u,t,n);i>0&&f.push([o,e,u,i,s])}u=u/a|0}return f}(function(t){const n=t.length>>2,e=new Uint8Array(n),r=new Uint32Array(t.buffer||new Uint8Array(t).buffer);let o=0,a=0,s=0;for(;o<n;)a=r[o],s=13933*(a>>>16&255)+46871*(a>>>8&255)+4732*(255&a)>>>16,e[o++]=s;return new Uint8ClampedArray(e.buffer)}(n),c,u,f,e,r,o,s);return function(t,n){t.sort((t,n)=>n[3]-t[3]);const e=new Uint8Array(t.length),r=[];for(let o=0;o<t.length;o++){if(e[o])continue;let a=t[o][0],s=t[o][1],c=t[o][2],f=t[o][3];const i=t[o][4];let u=1;for(let r=o+1;r<t.length;r++)e[r]||l(t[o],t[r])>n&&(e[r]=1,a+=t[r][0],s+=t[r][1],c+=t[r][2],f+=t[r][3],u++);r.push({r:a/u|0,c:s/u|0,s:c/u|0,q:f,a:i})}return r}(i(h),a)}}function n(n,e){const r=`(function(){${t.toString()};var detect=${t.name}([${new Int8Array(n).toString()}],${JSON.stringify(e||{})});onmessage=function(e){postMessage(detect(e.data));};})();`,o=new Blob([r],{type:"application/javascript"}),a=URL.createObjectURL(o),s=new Worker(a);return function(t){return new Promise(n=>{s.onmessage=t=>n(t.data),s.postMessage(t)})}}export{n as default};

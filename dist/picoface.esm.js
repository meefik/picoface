function t(t,n){const{shiftfactor:e=.1,scalefactor:r=1.1,initialsize:o=.1,threshold:a=.2,memory:s=1,rotation:c=[0]}=n,f=function(t){const n=new DataView(t.buffer,t.byteOffset,t.byteLength);let a=8;const s=n.getInt32(a,!0);a+=4;const f=1<<s,i=n.getInt32(a,!0);a+=4;const l=new Int8Array(4*i*f),u=new Float32Array(i*f),h=new Float32Array(i);for(let e=0;e<i;++e){const r=4*e*f;l[r+0]=0,l[r+1]=0,l[r+2]=0,l[r+3]=0;const o=4*f-4;l.set(t.subarray(a,a+o),r+4),a+=o;for(let t=0;t<f;++t)u[e*f+t]=n.getFloat32(a,!0),a+=4;h[e]=n.getFloat32(a,!0),a+=4}const g=new Int32Array(360),w=new Int32Array(360);for(let t=0;t<360;++t){const n=t*Math.PI/180;g[t]=256*Math.cos(n)|0,w[t]=256*Math.sin(n)|0}return function(t,n,a){const y=[],m=o*Math.sqrt(n*a)|0,A=c.length;let M=0|Math.min(n,a);for(;M>=m;){const o=e*M+1|0,m=M/2+1|0,p=new Array(A);for(let t=0;t<A;++t){const n=c[t],e=M*w[n],r=M*g[n],o=f,a=new Int32Array(i*o*4);for(let t=0;t<i;++t){const n=t*o*4;for(let s=0;s<o;++s){const o=4*(f*t+s),c=l[o+0],i=l[o+1],u=l[o+2],h=l[o+3];a[n+4*s+0]=r*c-e*i>>16,a[n+4*s+1]=e*c+r*i>>16,a[n+4*s+2]=r*u-e*h>>16,a[n+4*s+3]=e*u+r*h>>16}}p[t]=a}for(let e=m;e<a-m;e+=o)for(let r=m;r<n-m;r+=o){const o=e<<16,a=r<<16;for(let l=0;l<A;++l){const g=c[l],w=p[l];let m=0;for(let e=0;e<i;++e){let r=1;const c=e*f*4;for(let e=0;e<s;++e){const e=c+4*r,s=(o>>16)+w[e+0],f=(a>>16)+w[e+1],i=(o>>16)+w[e+2],l=(a>>16)+w[e+3];r=2*r+((0|t[s*n+f])<=(0|t[i*n+l])?1:0)}if(m+=u[f*(e-1)+r],m<=h[e]){m=0;break}}if(m>0){const t=m-h[i-1];t>0&&y.push([e,r,M,t,g])}}}M=M/r|0}return y}}(new Int8Array(t)),i=function(t){let n=0;const e=[];for(let n=0;n<t;++n)e.push([]);return function(t){e[n]=t,n=(n+1)%e.length,t=[];for(let n=0;n<e.length;++n)t=t.concat(e[n]);return t}}(s);function l(t,n){const[e,r,o]=t,[a,s,c]=n,f=Math.max(0,Math.min(e+o/2,a+c/2)-Math.max(e-o/2,a-c/2)),i=Math.max(0,Math.min(r+o/2,s+c/2)-Math.max(r-o/2,s-c/2)),l=Math.min(o,c);return f*i/(l*l)}return function(t){const{data:n,width:e,height:r}=t,o=function(t){const n=t.length>>2,e=new Uint8Array(n),r=new Uint32Array(t.buffer||new Uint8Array(t).buffer);let o=0,a=0,s=0;for(;o<n;)a=r[o],s=13933*(a>>>16&255)+46871*(a>>>8&255)+4732*(255&a)>>>16,e[o++]=s;return new Uint8ClampedArray(e.buffer)}(n),s=f(o,e,r);return function(t,n){t.sort((t,n)=>n[3]-t[3]);const e=new Uint8Array(t.length),r=[];for(let o=0;o<t.length;o++){if(e[o])continue;let a=t[o][0],s=t[o][1],c=t[o][2],f=t[o][3];const i=t[o][4];let u=1;for(let r=o+1;r<t.length;r++)e[r]||l(t[o],t[r])>n&&(e[r]=1,a+=t[r][0],s+=t[r][1],c+=t[r][2],f+=t[r][3],u++);r.push({r:a/u|0,c:s/u|0,s:c/u|0,q:f,a:i})}return r}(i(s),a)}}function n(n,e){const r=`(function(){${t.toString()};var detect=${t.name}([${new Int8Array(n).toString()}],${JSON.stringify(e||{})});onmessage=function(e){postMessage(detect(e.data));};})();`,o=new Blob([r],{type:"application/javascript"}),a=URL.createObjectURL(o),s=new Worker(a);return function(t){return new Promise(n=>{s.onmessage=t=>n(t.data),s.postMessage(t)})}}export{n as default};

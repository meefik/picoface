!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).PICO=n()}(this,function(){"use strict";function t(t,n){const{shiftfactor:e=.1,scalefactor:r=1.1,initialsize:o=.1,threshold:a=.2,rotation:f=[0],memory:s=1}=n,i=function(t){const n=new DataView(t.buffer,t.byteOffset,t.byteLength);let e=8;const r=n.getInt32(e,!0);e+=4;const o=1<<r,a=n.getInt32(e,!0);e+=4;const f=new Int8Array(4*a*o),s=new Float32Array(a*o),i=new Float32Array(a);for(let r=0;r<a;++r){const a=4*r*o;f[a+0]=0,f[a+1]=0,f[a+2]=0,f[a+3]=0;const c=4*o-4;f.set(t.subarray(e,e+c),a+4),e+=c;for(let t=0;t<o;++t)s[r*o+t]=n.getFloat32(e,!0),e+=4;i[r]=n.getFloat32(e,!0),e+=4}const c=new Int32Array(360),u=new Int32Array(360);for(let t=0;t<360;++t){const n=t*Math.PI/180;c[t]=256*Math.cos(n)|0,u[t]=256*Math.sin(n)|0}return function(t,n,e,l,h,g){t<<=16,n<<=16;const y=l*u[e|=0],d=l*c[e];let m=0;for(let e=0;e<a;++e){let a=1;for(let s=0;s<r;++s){const r=4*(o*e+a),s=f[r+0],i=f[r+1],c=f[r+2],u=f[r+3],l=t+d*c-y*u>>16,m=n+y*c+d*u>>16;a=2*a+((0|h[(t+d*s-y*i>>16)*g+(n+y*s+d*i>>16)])<=(0|h[l*g+m])?1:0)}if(m+=s[o*(e-1)+a],m<=i[e])return-1}return m-i[a-1]}}(new Int8Array(t)),c=function(t){let n=0;const e=[];for(let n=0;n<t;++n)e.push([]);return function(t){e[n]=t,n=(n+1)%e.length,t=[];for(let n=0;n<e.length;++n)t=t.concat(e[n]);return t}}(s);function u(t,n){const[e,r,o]=t,[a,f,s]=n,i=Math.max(0,Math.min(e+o/2,a+s/2)-Math.max(e-o/2,a-s/2)),c=Math.max(0,Math.min(r+o/2,f+s/2)-Math.max(r-o/2,f-s/2)),u=Math.min(o,s);return i*c/(u*u)}return function(t){const{data:n,width:s,height:l}=t,h=function(t,n,e,r,o,a,f,s){const i=[],c=s.length,u=f*Math.sqrt(n*e)|0;let l=0|Math.min(n,e);for(;l>=u;){const f=o*l+1|0,u=l/2+1|0;for(let o=u;o<e-u;o+=f)for(let e=u;e<n-u;e+=f)for(let a=0;a<c;a++){const f=s[a],c=r(o,e,f,l,t,n);c>0&&i.push([o,e,l,c,f])}l=l/a|0}return i}(function(t){const n=t.length>>2,e=new Uint8Array(n),r=new Uint32Array(t.buffer||new Uint8Array(t).buffer);let o=0,a=0,f=0;for(;o<n;)a=r[o],f=13933*(a>>>16&255)+46871*(a>>>8&255)+4732*(255&a)>>>16,e[o++]=f;return new Uint8ClampedArray(e.buffer)}(n),s,l,i,e,r,o,f);return function(t,n){t.sort((t,n)=>n[3]-t[3]);const e=new Uint8Array(t.length),r=[];for(let o=0;o<t.length;o++){if(e[o])continue;let a=t[o][0],f=t[o][1],s=t[o][2],i=t[o][3];const c=t[o][4];let l=1;for(let r=o+1;r<t.length;r++)e[r]||u(t[o],t[r])>n&&(e[r]=1,a+=t[r][0],f+=t[r][1],s+=t[r][2],i+=t[r][3],l++);r.push({r:a/l|0,c:f/l|0,s:s/l|0,q:i,a:c})}return r}(c(h),a)}}return function(n,e){const r=`(function(){${t.toString()};var detect=${t.name}([${new Int8Array(n).toString()}],${JSON.stringify(e||{})});onmessage=function(e){postMessage(detect(e.data));};})();`,o=new Blob([r],{type:"application/javascript"}),a=URL.createObjectURL(o),f=new Worker(a);return function(t){return new Promise(n=>{f.onmessage=t=>n(t.data),f.postMessage(t)})}}});
